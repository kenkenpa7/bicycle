const quizData = [
    // --- 第1章: 法令・規格 ---
    {
        question: "道路交通法施行規則が定める「普通自転車」の車体の大きさとして、正しいものはどれか。",
        options: [
            "長さ180cm以下、幅50cm以下",
            "長さ190cm以下、幅60cm以下",
            "長さ190cm以下、幅70cm以下",
            "長さ200cm以下、幅60cm以下"
        ],
        answer: 1,
        explanation: "正解は「長さ190cm以下、幅60cm以下」。この基準は、歩道通行の例外規定が適用される自転車の条件となります。この具体的な数値を正確に暗記しておくことが非常に重要です。"
    },
    {
        question: "自転車の制動装置（ブレーキ）の性能基準として、道路交通法施行規則で定められているものはどれか。",
        options: [
            "時速10kmからの制動距離が3m以内",
            "時速10kmからの制動距離が5m以内",
            "時速15kmからの制動距離が5m以内",
            "時速20kmからの制動距離が8m以内"
        ],
        answer: 0,
        explanation: "正解は「時速10kmからの制動距離が3m以内」。この基準は乾燥した平坦な舗装路面での性能を指します。実技試験の知識としても必須であり、筆記試験でも頻出の数値です。"
    },
    {
        question: "各種マークに関する説明として、最も適切なものはどれか。",
        options: [
            "JISマークは、製品の欠陥による人身事故を補償する保険が付帯する。",
            "SGマークは、自転車組立整備士による組立を要件とする。",
            "BAAマークは、JIS規格を包含し、さらに厳しい約90項目の自主安全基準を設けている。",
            "TSマークは、製造物責任法（PL法）に基づく国の認定マークである。"
        ],
        answer: 2,
        explanation: "正解は選択肢3です。BAAマークはJIS規格をベースに、より厳しい自主基準を設けているのが特徴です。1はSGマークの説明、2はBAAマークの要件、4のTSマークは日本交通管理技術協会が実施する制度で、PL法とは直接関係ありません。"
    },
    {
        question: "製造物責任法（PL法）における「欠陥」に該当しないものはどれか。",
        options: [
            "ブレーキの構造自体に問題がある「設計上の欠陥」",
            "フレームの一部に溶接不良があった「製造上の欠陥」",
            "カーボンパーツの適正トルクが明記されていない「指示・警告上の欠陥」",
            "使用者が長年メンテナンスを怠ったことによる「経年劣化」"
        ],
        answer: 3,
        explanation: "正解は「経年劣化」。PL法が対象とするのは製品の引き渡し時点で存在した「欠陥」であり、使用者の維持管理不足や正常な使用による損耗（経年劣化）は対象外です。欠陥の3類型（設計上、製造上、指示・警告上）をしっかり理解しておきましょう。"
    },
    {
        question: "TSマーク付帯保険の有効期間として正しいものはどれか。",
        options: [
            "点検整備日から6ヶ月間",
            "点検整備日から1年間",
            "点検整備日から2年間",
            "自転車の購入から3年間"
        ],
        answer: 1,
        explanation: "正解は「点検整備日から1年間」。TSマークは自転車安全整備士による点検整備の証であり、その安全性と保険の有効性は1年間です。1年ごとに再度点検整備を受けることで、更新が可能です。"
    },
    // --- 第2章: フレーム・フォーク ---
    {
        question: "フレームジオメトリーに関する記述として、正しいものはどれか。",
        options: [
            "キャスター角が立つ（角度が大きい）と直進安定性が増す。",
            "フォークオフセットを大きくするとトレール量は小さくなる。",
            "トレール量が大きいほどハンドリングは機敏（クイック）になる。",
            "キャスター角とトレール量は互いに無関係である。"
        ],
        answer: 1,
        explanation: "正解は「フォークオフセットを大きくするとトレール量は小さくなる」。トレール量は、直進安定性を生む重要な要素です。フォークオフセットを大きくすると前輪軸が前方に移動するため、ヘッドチューブ延長線と接地点との距離であるトレールは短くなります。1と3は逆の説明、4は誤りです。"
    },
    {
        question: "異種金属接触腐食（ガルバニック腐食）が最も発生しやすい金属の組み合わせはどれか。",
        options: [
            "アルミニウムとステンレス鋼",
            "クロモリ鋼とチタン",
            "カーボン（炭素繊維）とアルミニウム",
            "チタンとアルミニウム"
        ],
        answer: 2,
        explanation: "正解は「カーボンとアルミニウム」。カーボンは電位が高く（貴）、アルミニウムは電位が低い（卑）ため、電位差が非常に大きくなります。水分を介して接触すると、アルミニウム側が激しく腐食します。組み立て時には絶縁用のグリス等が必須です。"
    },
    {
        question: "ヘッドパーツの形式で、フォークコラムにねじ切りがなく、ステムを被せて固定する方式を何と呼ぶか。",
        options: [
            "スレッド式",
            "アヘッド式（スレッドレス式）",
            "インテグラル式",
            "イタリアン式"
        ],
        answer: 1,
        explanation: "正解は「アヘッド式（スレッドレス式）」。現在のスポーツバイクの主流です。フォークコラムの突き出し量をステムの上下で調整し、トップキャップで玉当たり調整、ステムのボルトで最終固定します。スレッド式は旧来のねじ切り方式です。"
    },
    {
        question: "フレーム素材に関する記述として、誤っているものはどれか。",
        options: [
            "クロモリ鋼は、しなやかで乗り心地が良く、溶接修理が可能である。",
            "アルミニウム合金は、軽量で剛性が高いが、乗り心地は硬めになる傾向がある。",
            "カーボンファイバーは、非常に軽量だが、特定の方向からの衝撃に弱い性質がある。",
            "チタン合金は、錆びにくく軽量だが、金属疲労を起こしやすい。"
        ],
        answer: 3,
        explanation: "誤っているのは選択肢4です。チタン合金は金属の中でも特に疲労破壊に対する耐性が非常に高い（高い疲労限度を持つ）ことで知られています。そのため、理論上は半永久的に使用できるとも言われます。"
    },
    // --- 第3章: 駆動・変速系 ---
    {
        question: "ねじ切り式ボトムブラケット（BB）の規格で、シェル幅70mm、左右のワンが共に正ネジなのはどの規格か。",
        options: [
            "JIS (BSC/BSA) 規格",
            "イタリアン規格",
            "フレンチ規格",
            "スパニッシュ規格"
        ],
        answer: 1,
        explanation: "正解は「イタリアン規格」。シェル幅70mm、左右共に正ネジという特徴を持ちます。最も一般的なJIS規格はシェル幅68mm/73mmで、右ワンが逆ネジである点との違いを明確に区別できるようにしましょう。"
    },
    {
        question: "自転車用チェーンの規格に関する記述として、正しいものはどれか。",
        options: [
            "変速段数が多くなるほど、チェーンのピッチ（リンク間の距離）は長くなる。",
            "8速用チェーンを11速用コンポーネントに使用できる。",
            "チェーンの伸び率が1%を超えたら交換時期の目安である。",
            "チェーンの伸びは、プレート自体が伸びる現象である。"
        ],
        answer: 2,
        explanation: "正解は選択肢3です。チェーンの伸びは、プレートではなくピンとブッシュ（ローラー）の接合部が摩耗してガタが大きくなる現象です。伸び率が0.75%～1%で交換が推奨されます。1のピッチは全段数で1/2インチで共通。2は段数が多くなるほどチェーン幅が狭くなるため互換性はありません。"
    },
    {
        question: "リアディレイラーの調整で、変速機がローギアを越えてスポーク側に脱落するのを防ぐために調整するボルトはどれか。",
        options: [
            "Hアジャストボルト",
            "Lアジャストボルト",
            "Bテンションアジャストボルト",
            "ケーブルアジャスター"
        ],
        answer: 1,
        explanation: "正解は「Lアジャストボルト」。Lは「Low（ローギア）」を意味し、ディレイラーの内側（スポーク側）への最大可動範囲を制限します。Hは「High（トップギア）」で外側への可動範囲、Bテンションはガイドプーリーとスプロケットの間隔、ケーブルアジャスターはワイヤーの張りを調整します。"
    },
    {
        question: "クランクのQファクターとは何を指すか。",
        options: [
            "クランクアームの長さ",
            "左右のペダル取り付け面の距離",
            "ペダル軸の中心からクランクアームまでの距離",
            "クランクのスパイダーアームの本数"
        ],
        answer: 1,
        explanation: "正解は「左右のペダル取り付け面の距離」。Qファクターが狭いと、左右の足のスタンスが狭くなり、ペダリング効率が向上するとされますが、狭すぎるとフレームや使用者の骨格によっては干渉の恐れもあります。"
    },
    // --- 第4章: 制動装置（ブレーキ） ---
    {
        question: "Vブレーキの調整で、音鳴りを防止しコントロール性を向上させるために、ブレーキシューを進行方向に対してわずかに前方から接触させる調整を何というか。",
        options: [
            "トーアウト",
            "トーイン",
            "キャンバー",
            "キャスター"
        ],
        answer: 1,
        explanation: "正解は「トーイン」。ブレーキシューの後方が先に接触するのをトーアウトと呼びますが、通常はトーイン調整を行います。これにより、ブレーキ時にシュー全体が一度にリムに張り付くことで発生する共振（音鳴り）を防ぎます。"
    },
    {
        question: "油圧ディスクブレーキのメンテナンス作業で、ブレーキライン内の古いオイルを抜き、新しいオイルを充填してエアを抜く作業を何と呼ぶか。",
        options: [
            "フェイシング",
            "リーミング",
            "ブリーディング",
            "タッピング"
        ],
        answer: 2,
        explanation: "正解は「ブリーディング」。ブレーキフルードは吸湿性があったり（DOT）、高温にさらされたりして劣化するため、定期的なブリーディングが必要です。これにより、レバータッチの改善や安定した制動性能を維持します。"
    },
    {
        question: "Vブレーキと、それに対応していないカンチブレーキ用レバーを組み合わせて使用した場合、どのような現象が起こるか。",
        options: [
            "ブレーキレバーが重すぎて引けなくなる。",
            "ブレーキの効きが極端に甘くなる。",
            "レバーを少し引いただけでも急激にブレーキが効き、非常に危険である。",
            "特に問題なく使用できる。"
        ],
        answer: 2,
        explanation: "正解は選択肢3です。Vブレーキはてこ比が非常に大きいため、ワイヤーの引き量が大きい専用レバーが必要です。引き量の少ないカンチ用レバーで引くと、小さなレバー操作で過大な制動力がかかり、非常に危険な「カックンブレーキ」状態になります。"
    },
    {
        question: "ディスクブレーキローターの固定方式として、6本のボルトで固定する方式と、スプライン（歯）で固定するロックリングを用いる方式の名称の組み合わせとして正しいものはどれか。",
        options: [
            "IS方式 と ポストマウント方式",
            "6ボルト方式 と センターロック方式",
            "スルーアクスル方式 と クイックリリース方式",
            "メカニカル方式 と ハイドロリック方式"
        ],
        answer: 1,
        explanation: "正解は「6ボルト方式 と センターロック方式」。6ボルトは汎用性が高く、センターロックはシマノが提唱する規格で、専用工具を使えば着脱が迅速に行える利点があります。1はブレーキキャリパーの台座規格、3は車輪の固定方式、4はブレーキの作動方式です。"
    },
    // --- 第5章: ホイール・タイヤ ---
    {
        question: "タイヤサイズの表記で、互換性を判断する上で最も信頼性の高い国際規格はどれか。",
        options: [
            "インチ表記 (例: 26 x 1.75)",
            "フランス式表記 (例: 700 x 25C)",
            "ETRTO表記 (例: 25-622)",
            "TPI表記 (例: 120 TPI)"
        ],
        answer: 2,
        explanation: "正解は「ETRTO表記」。ETRTO（エトルト）はタイヤ幅(mm)とビード径(mm)で示され、ビード径が同じであればリムとタイヤに互換性があります。例えば700Cと29インチは呼び径が違いますが、ETRTOビード径は共に622mmで互換性があります。"
    },
    {
        question: "タイヤのケーシングの繊維密度を示す「TPI」に関する記述として正しいものはどれか。",
        options: [
            "TPI値が高いほど、タイヤは硬く頑丈になる。",
            "TPI値が高いほど、繊維が細く高密度になり、タイヤはしなやかになる。",
            "TPI値が高いほど、耐パンク性能は向上する。",
            "TPIはタイヤの空気圧の上限値を示している。"
        ],
        answer: 1,
        explanation: "正解は選択肢2です。TPI (Threads Per Inch) は1インチあたりの繊維の数を示します。高TPIのタイヤは細い糸を多く使うため、しなやかになり、路面追従性が向上し転がり抵抗が低減します。逆に低TPIは太い糸で頑丈ですが、硬くなります。"
    },
    {
        question: "ホイールの横振れを修正する際に、振れている箇所をリムの中心に戻すための基本的な操作はどれか。",
        options: [
            "振れている側のスポークを強く締め込む。",
            "振れている箇所の反対側のスポークを張る（締める）か、振れている側のスポークを緩める。",
            "左右両方のスポークを均等に締め込む。",
            "ハブ軸のナットを締め直す。"
        ],
        answer: 1,
        explanation: "正解は選択肢2です。例えばリムが右に振れている場合、その箇所の右側スポークを緩めるか、左側スポークを締めることで、リムを左側（中心）に引き寄せることができます。これが振れ取りの基本原則です。"
    },
    {
        question: "チューブのバルブ形式で、自動車やオートバイと共通で、ガソリンスタンドの空気入れも使用可能なものはどれか。",
        options: [
            "英式（ウッズ）バルブ",
            "米式（シュレーダー）バルブ",
            "仏式（プレスタ）バルブ",
            "独式（ダンロップ）バルブ"
        ],
        answer: 1,
        explanation: "正解は「米式（シュレーダー）バルブ」。頑丈な構造が特徴で、MTBや一部のクロスバイク、シティサイクルに採用されています。英式は一般車、仏式はスポーツバイクで主流です。独式は英式とほぼ同じ構造です。"
    },
    // --- 第6章: 整備・工具・その他 ---
    {
        question: "カーボンファイバー製の部品（シートポストなど）を固定する際に最も重要なことは何か。",
        options: [
            "グリスを一切塗布せずに固定する。",
            "指定された締め付けトルクをトルクレンチで管理する。",
            "錆を防ぐために、たっぷりとグリスを塗布する。",
            "体重をかけて、できるだけ強く締め付ける。"
        ],
        answer: 1,
        explanation: "正解は選択肢2です。カーボンは過大な圧力に弱く、締めすぎると簡単に破断（クラック）します。必ずメーカー指定のトルク値を守る必要があり、そのためにトルクレンチの使用が不可欠です。4のような行為は絶対に避けなければなりません。"
    },
    {
        question: "ねじの締め付けにおいて、塑性域（そせいいき）締め付けとはどのような締め付け方法か。",
        options: [
            "ねじが元の形に戻る範囲（弾性域）で締め付ける方法。",
            "ねじをあえて少し伸ばし、元に戻らない領域（塑性域）まで締め付けることで、高い軸力を得る方法。",
            "手ルク（手の感覚）で締め付ける方法。",
            "トルクレンチを使わずにインパクトドライバーで締め付ける方法。"
        ],
        answer: 1,
        explanation: "正解は選択肢2です。塑性域締め付けは、ねじが伸びて元に戻らなくなるほどの高いトルクで締め付け、緩みにくく高い締結力を得る方法です。自動車のエンジン部品などで使われますが、一度使用したボルトは伸びているため再使用はできません。"
    },
    {
        question: "ペダルのねじに関する記述として、正しいものはどれか。",
        options: [
            "左右ともに正ネジである。",
            "左右ともに逆ネジである。",
            "右ペダルが逆ネジ、左ペダルが正ネジである。",
            "右ペダルが正ネジ、左ペダルが逆ネジである。"
        ],
        answer: 3,
        explanation: "正解は選択肢4です。これもペダリングによる緩みを防ぐための設計です。右ペダルは進行方向と同じ時計回りに、左ペダルは反時計回りに回すと締まります。これにより、ペダリング中に自然と締まる方向に力がかかります。"
    },
    {
        question: "自転車の安全点検項目の語呂合わせ「ブタベルサハシ」の「シ」が指す項目として、適切でないものはどれか。",
        options: [
            "車体の歪みや亀裂",
            "チェーンの錆びや伸び",
            "ペダルのガタつき",
            "シフトワイヤーのほつれ"
        ],
        answer: 3,
        explanation: "正解は選択肢4です。「ブタベルサハシ」は点検の基本項目で、ブ(ブレーキ)、タ(タイヤ)、ベル、サ(サドル)、ハ(ハンドル)、シ(車体・チェーン・ペダル周り)を指します。シフトワイヤーは重要ですが、この語呂合わせには直接含まれていません。"
    },
    {
        question: "サドルの前後位置を調整する際の一般的な目安はどれか。",
        options: [
            "サドルの先端がハンドルバーステムの真上に来る位置",
            "クランクを水平にしてペダルに足を置いた時、膝の皿の真下とペダル軸が垂直線で結ばれる位置",
            "足を地面についた時、つま先がギリギリ届く位置",
            "乗車して腕を伸ばした時、肘が軽く曲がる位置"
        ],
        answer: 1,
        explanation: "正解は選択肢2です。これは効率的なペダリングと膝への負担を軽減するための基本的なセッティング方法です。おもりを付けた糸などを膝から垂らして確認します。他の選択肢は、サドルの高さやハンドルまでの距離に関連するものです。"
    },
    {
        question: "ワイヤーカッターで切断したインナーワイヤーの末端がほつれないように被せる金属製のキャップを何というか。",
        options: [
            "フェルール",
            "エンドキャップ",
            "ニップル",
            "グロメット"
        ],
        answer: 1,
        explanation: "正解は「エンドキャップ」。これを装着し、専用工具でかしめる（潰して固定する）ことで、ワイヤーのほつれを防ぎ、見た目もきれいに仕上がります。フェルールはアウターケーブルの末端に付けるキャップです。"
    },
    {
        question: "一般的な自転車用ベアリングで、鋼球（ボール）が直接ワン（受け皿）の上を転がる形式のベアリングを何と呼ぶか。",
        options: [
            "シールドベアリング",
            "カップアンドコーン式ベアリング",
            "ニードルローラーベアリング",
            "スラストベアリング"
        ],
        answer: 1,
        explanation: "正解は「カップアンドコーン式ベアリング」。ハブやBB、ヘッドパーツなどで古くから使われている形式です。分解して清掃やグリスアップ、玉当たり調整（ガタの調整）が可能なのが特徴です。シールドベアリングは一体型でメンテナンスフリーですが、不具合が出たらユニットごとの交換となります。"
    },
    {
        question: "7分組の自転車を組み立てる際に、自転車技士が行う必要のない作業はどれか。",
        options: [
            "ホイールの振れ取り",
            "ヘッドパーツの圧入",
            "ブレーキ・変速機の調整",
            "各部ボルトの適正トルクでの締め付け"
        ],
        answer: 1,
        explanation: "正解は「ヘッドパーツの圧入」。7分組（または9分組）の自転車は、フレームにヘッドパーツやBBが既に圧入・組み付けられた状態で工場から出荷されます。技士の主な作業は、ホイールの装着、ハンドル・サドル・ペダルの取り付け、および全体の調整・点検です。"
    },
    {
        question: "自転車の分解整備で、クランクアームをBBシャフトから引き抜くために使用する専用工具はどれか。",
        options: [
            "チェーンカッター",
            "スプロケットリムーバー",
            "コッタレスクランク抜き",
            "ペダルレンチ"
        ],
        answer: 2,
        explanation: "正解は「コッタレスクランク抜き」。この工具をクランクにねじ込み、中心のボルトを締め込んでいくことで、てこの原理で固く嵌合しているクランクをBBシャフトから安全に引き抜くことができます。"
    }
];


// --- 以下、アプリの動作ロジック（変更不要） ---
const questionNumberEl = document.getElementById('question-number');
const questionTextEl = document.getElementById('question-text');
const optionsContainerEl = document.getElementById('options-container');
const feedbackAreaEl = document.getElementById('feedback-area');
const nextBtn = document.getElementById('next-btn');
const quizContainer = document.getElementById('quiz-container');
const resultContainer = document.getElementById('result-container');
const scoreTextEl = document.getElementById('score-text');
const resultMessageEl = document.getElementById('result-message');

let currentQuestionIndex = 0;
let score = 0;

function loadQuiz() {
    feedbackAreaEl.style.display = 'none';
    nextBtn.style.display = 'none';

    const currentQuizData = quizData[currentQuestionIndex];
    
    questionNumberEl.innerText = `問題 ${currentQuestionIndex + 1} / ${quizData.length}`;
    questionTextEl.innerText = currentQuizData.question;
    optionsContainerEl.innerHTML = '';

    currentQuizData.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.innerText = option;
        button.addEventListener('click', () => selectOption(index));
        optionsContainerEl.appendChild(button);
    });
}

function selectOption(selectedIndex) {
    const currentQuizData = quizData[currentQuestionIndex];
    const correctIndex = currentQuizData.answer;

    Array.from(optionsContainerEl.children).forEach((button, index) => {
        if (index === correctIndex) {
            button.classList.add('correct');
        } else if (index === selectedIndex) {
            button.classList.add('incorrect');
        }
        button.disabled = true;
    });

    if (selectedIndex === correctIndex) {
        score++;
        feedbackAreaEl.innerHTML = `<strong>正解！</strong><br>${currentQuizData.explanation}`;
        feedbackAreaEl.className = 'feedback-area correct';
    } else {
        feedbackAreaEl.innerHTML = `<strong>不正解...</strong><br>${currentQuizData.explanation}`;
        feedbackAreaEl.className = 'feedback-area incorrect';
    }

    feedbackAreaEl.style.display = 'block';
    nextBtn.style.display = 'block';
}

function showResult() {
    quizContainer.style.display = 'none';
    resultContainer.style.display = 'block';
    scoreTextEl.innerText = `${quizData.length}問中 ${score}問 正解！`;

    let message = '';
    const percentage = (score / quizData.length) * 100;
    if (percentage === 100) {
        message = '完璧です！全問正解！自信を持って試験に臨んでください！';
    } else if (percentage >= 80) {
        message = '素晴らしい成績です。合格圏内です。間違えた数問を完璧にすれば、もう安心です。';
    } else if (percentage >= 60) {
        message = 'おしい！合格ラインは目前です。特に間違えた分野の解説を重点的に復習しましょう。';
    } else {
        message = '基礎からじっくり復習が必要です。解説を何度も読み返し、知識の土台を固めましょう。';
    }
    resultMessageEl.innerText = message;
}

nextBtn.addEventListener('click', () => {
    currentQuestionIndex++;
    if (currentQuestionIndex < quizData.length) {
        loadQuiz();
    } else {
        showResult();
    }
});

// 最初のクイズを読み込む
loadQuiz();